﻿<!-- GOVERNANCE:BEGIN -->
<!--
  このセクションはオーケストレーターによって管理されています。
  手動編集は次回同期時に上書きされます。
  プロジェクト固有の内容は LOCAL セクションに記述してください。
-->

# プロジェクトガバナンス（継承）
継承: O:\Dev\CLAUDE.md → O:\Dev\Work\_orchestrator\CLAUDE.md → このファイル

## 開発要件（継承）
### 言語設定
**日本語一律使用**: 必須・コメント・commit全て日本語
### 基本原則
- 抽象化: 共通処理100%/2箇所使用→即共通化/DRY
- 資源活用: 既存確認必須・改良優先
### 禁止事項
- 未テストコミット
- 認証情報ハードコード
- 脆弱性導入
- UTF-8以外のエンコーディング

## ミッション
**AIによる人間代替作業の実行と収益化**

## セッション終了時必須作業
1. 作業記録: logs/claude_runs に保存
2. Git Push: 全変更をコミット→プッシュ
3. 次回引継ぎ: 未完了タスク・課題を明記
## Orchestrator統制
- logs/claude_runs にログ保存必須
- STATUS.md を最新状態に維持
- 失敗時は failure_classification を設定
<!-- GOVERNANCE:END -->

<!-- LOCAL:BEGIN -->
<!--
  このセクションはプロジェクト固有の内容です。
  オーケストレーター同期時も保持されます。
-->

# DevBuddyAI - プロジェクト固有設定
---

## 開発ツール要件
### コード品質
- ドキュメント: 全public関数に必須
- テストカバレッジ: 80%+
- 静的解析: 必ず通過

### API設計
- RESTful原則遵守
- エラーレスポンス標準化
- 認証/認可の適切な実装
---

## ミッション

**AIによる人間代替作業の実行と収益化**

本プロジェクトのAIは**プロフェッショナル**として以下を遵守する：
- 収益を得るに相応しい品質の成果物を提供
- 誠実かつ雑さを許さない姿勢
- 批判的視点で自らの成果物を監視・改善

**収益モデル**: SaaS・API課金
---

## プロジェクト概要
**DevBuddyAI**はAIを活用した開発者支援ツール。コードレビュー、テスト生成、バグ修正提案を自動化し、開発効率を大幅に向上させる。
### ビジョン
- 開発者の「AIペアプログラマー」として機能
- コード品質向上とレビュー時間削減を両立
- 既存の開発プロセスに統合可能な柔軟性

---

## コア機能

### 1. AIコードレビュー
- コード変更（diff/ファイル）をAIが分析
- バグ、スタイル違反、ドキュメント不足を指摘
- 改善提案を具体的なコード例で提示

### 2. テスト自動生成
- 関数/クラスからユニットテストを自動生成
- エッジケース、境界値テストを考慮
- pytest/unittest形式で出力
### 3. バグ修正提案
- 失敗テストや既知バグに対する修正案を提示
- 修正コードを自動生成し検証可能

### 4. 統合オプション
- **CLI**: `devbuddy review <file>` / `devbuddy testgen <file>`
- **GitHub Action/Bot**: PR自動コメント
- **IDE Plugin**: 将来対応予定
---

## 実装設計
### アーキテクチャ
```
┌─────────────┐    ┌──────────────────┐    ┌─────────────┐
│  CLI/API   │───▶│ Core Engine │───▶│ LLM API    │
└─────────────┘    └──────────────────┘    └─────────────┘
                           │
                    ┌──────┴───────┐
                    ▼             ▼
              ┌──────────┐ ┌──────────┐
              │ Analyzer │ │ Generator│
              └──────────┘ └──────────┘
```

### 実装スタック
| コンポーネント | 実装 |
|---------------|------|
| 言語 | Python 3.12+ |
| CLI | Click |
| LLM API | Claude API / OpenAI API |
| 静的解析 | ast, flake8, pylint |
| テスト | pytest |
| GitHub連携 | PyGithub |

### ディレクトリ構造
```
DevBuddyAI/
├── src/devbuddy/         # メインパッケージ
│   ├── __init__.py
│   ├── cli.py            # CLIエントリポイント
│   ├── core/
│   │   ├── reviewer.py   # コードレビューエンジン
│   │   ├── generator.py  # テスト生成エンジン
│   │   └── fixer.py      # バグ修正エンジン
│   ├── llm/
│   │   ├── client.py     # LLM APIクライアント
│   │   └── prompts.py    # プロンプトテンプレート
│   ├── analyzers/
│   │   ├── python_analyzer.py
│   │   └── js_analyzer.py
│   └── integrations/
│       ├── github.py     # GitHub連携
│       └── git.py        # Git操作
├── samples/              # サンプルコード
├── tests/                # テストコード
├── docs/                 # ドキュメント
└── .github/workflows/    # GitHub Actions
```

---

## 処理フロー

### コードレビュー
1. ファイル/diffを読み込み
2. 言語を検出し適切なAnalyzerを選択
3. 静的解析を実行（flake8等）
4. コードをLLMに送信（プロンプト付き）
5. レスポンスを解析しフォーマット
6. 結果を出力（CLI/GitHub Comment）
### テスト生成
1. 対象ファイル/関数を解析
2. 関数シグネチャ、docstring、依存ヒントを抽出
3. LLMにテスト生成を依頼
4. 生成テストを実行し検証
5. 失敗時は修正を試行（最大3回）
### 自己検証ループ
```
生成 → 実行 → 失敗 → 修正 → 再実行
         │             │
       成功 ←─────────┘
```

---

## 対応言語
### Phase 1（初期）
- **Python**: ast解析 + flake8 + mypy

### Phase 2（拡張）
- **JavaScript/TypeScript**: ESLint連携
- **Rust**: clippy連携
- **Go**: go vet連携

---

## セキュリティ考慮

### APIキー管理
- 環境変数経由のみ（`DEVBUDDY_API_KEY`）
- ハードコード絶対禁止
- `.env`ファイル対応（gitignore必須）
### コードのプライバシー
- ローカル処理オプション提供
- エンタープライズ向け自己ホスト版
- 送信前にユーザー確認オプション

### データ保護
- コードはAPIコール後に保持しない
- ログにコード内容を含めない設計
---

## マネタイズ戦略

### 価格モデル
| プラン | 対象 | 価格 |
|--------|------|------|
| Free | OSS（公開リポジトリ） | 無料 |
| Pro | 個人/小規模チーム | $19/月 |
| Team | 中規模チーム（10名まで） | $99/月 |
| Enterprise | 大企業・自己ホスト | 要問合せ |

### 機能制限
| 機能 | Free | Pro | Team | Enterprise |
|------|------|-----|------|------------|
| レビュー回数/月 | 50 | 500 | 無制限 | 無制限 |
| ファイルサイズ | 500行 | 2000行 | 無制限 | 無制限 |
| プライベートリポ | × | ○ | ○ | ○ |
| GitHub連携 | × | ○ | ○ | ○ |
| 自己ホスト | × | × | × | ○ |
| 優先サポート | × | × | ○ | ○ |

### 差別化要件
- 自己検証ループによる高精度提案
- エンタープライズ向けオンプレ対応
- 複数言語対応の柔軟性

---

## 開発計画

### Phase 1: 基盤構築
- [x] プロジェクト構造作成
- [ ] CLI基本構造（Click）
- [ ] LLMクライアント実装
- [ ] プロンプトテンプレート設計
### Phase 2: コアエンジン
- [ ] Pythonコードレビュー機能
- [ ] テスト生成機能
- [ ] 自己検証ループ実装
### Phase 3: 統合
- [ ] GitHub Action対応
- [ ] PR自動コメント機能
- [ ] 設定ファイル対応
### Phase 4: 拡張
- [ ] 追加言語対応
- [ ] バグ修正提案機能
- [ ] ライセンス/認証システム

---

## 環境設定
### 環境変数
```bash
DEVBUDDY_API_KEY=<claude/openai api key>
DEVBUDDY_MODEL=claude-3-opus  # または gpt-4
DEVBUDDY_LOG_LEVEL=INFO
GITHUB_TOKEN=<optional for github integration>
```

### 設定ファイル（devbuddy.yaml）
```yaml
language: python
style_guide: pep8
max_file_size: 2000
ignore_patterns:
  - "*.generated.py"
  - "migrations/*"
review:
  severity: medium  # low/medium/high
  include_suggestions: true
testgen:
  framework: pytest
  coverage_target: 80
```

---

## 禁止事項
- APIキーのハードコード
- ユーザーコードのログ出力
- 無断での外部API送信
- テスト未実行でのリリース

---

## 品質基準
- ユニットテストカバレッジ: 80%+
- ドキュメント: 全public関数
- ドキュメント: 全public API
- 静的解析: flake8/mypy通過必須
---

## セッション終了時の必須作業

**CRITICAL**: 作業終了前に必ず実行
1. **作業記録**: 変更内容を簡潔に記録（無駄長禁止）
2. **Git Push**: 全変更をコミット→プッシュ
3. **次回引継ぎ**: 未完了タスク・課題を明記
---

## セッション開始チェックリスト
- [ ] このCLAUDE.mdを確認
- [ ] `.claude/CORRECTION_ORDER.md`の有無確認（あれば最優先対応）
- [ ] `.claude/SESSION_REPORT.md`で前回の状況確認
- [ ] README.mdで現状把握
- [ ] 作業計画をTodoWriteで作成

---

## Orchestrator統制（CRITICAL）
### 強制レポート制度

本プロジェクトはOrchestratorの統制下にあり、以下を遵守する：
#### セッション終了時の必須更新
1. **SESSION_REPORT.md**（`.claude/SESSION_REPORT.md`）
   - 収益化進捗の記録
   - 今回の作業内容と収益貢献度
   - 次回推奨アクション
   - 自己診断

2. **REVENUE_METRICS.md**（`.claude/REVENUE_METRICS.md`）
   - 収益状況に変更があれば更新
   - ロードマップ進捗の更新

#### 軌道修正指示への対応
- `.claude/CORRECTION_ORDER.md`が存在する場合は**最優先で対応**
- 対応完了後、ファイルを削除しセッションレポートに記録

### 収益化優先順位
| 優先順位 | 作業種別 | 例 |
|--------|----------|-----|
| 1（最高） | 直接収益 | 課金機能、販売ページ |
| 2 | 収益準備 | MVP完成、データ基盤 |
| 3 | 収益基盤 | コア機能、品質向上 |
| 4 | 収益間接 | ドキュメント、テスト |
| 5（最低） | 非収益 | リファクタリングのみ |

**ルール**: 優先順位5の作業は収益化完了まで原則禁止

### 逸脱の自己申告
収益化から外れる作業を行う場合：
1. 理由をSESSION_REPORT.mdに記録
2. 収益化への影響を評価
3. 代替案または復帰計画を提示

---

## AI行動原則

### 自発的貢献の姿勢
AIは指示待ちではなく、先を考え、最善を尽くす：
| 原則 | 行動 |
|------|------|
| **自己駆動** | 指示がなくても必要な作業を自ら発見・提案 |
| **完遂責任** | 途中で止めない。完了まで責任を持つ |
| **品質追求** | 「動けばいい」ではなく「収益に値する品質」を追求 |
| **批判的視点** | 自分の成果物を厳しく診断し、弱点を見つける |
| **誠実性** | 不明点・曖昧点は隠さず明確にする |

### 怠慢・逃避の禁止

以下は**絶対禁止**：
- 「後でやる」と言って放置
- 「簡易化のため逃避」と言って必要な処理をスキップ
- 「時間がないので」と言って品質を落とす
- 確認せずに推測で進める
- エラーを見なかったことにする

---

## 自己点検基準
プロフェッショナルとして、成果物提出前に以下を自問：
| 観点 | チェック |
|------|---------|
| 収益価値 | この成果物に対価を払う価値があるか？ |
| 品質 | 雑さした箇所はないか？ |
| 誠実性 | 不明点を曖昧にしていないか？ |
| 完全性 | 依頼された要件を満たしているか？ |
| 継続性 | 次のセッションで引き継げる状態か？ |

**一つでもNoなら、提出前に改善すること**

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2026-01-05 | Orchestrator共通要件を追加 |
| 2026-01-05 | O:\Dev\CLAUDE.md継承要件を追加 |
| 2026-01-06 | AI行動原則・怠慢禁止・継続性観点を追加 |
| 2026-01-06 | Orchestrator統制要件を追加 |

<!-- LOCAL:END -->

<!--
Orchestrator管理タグ（編集禁止）
TEMPLATE_VERSION: 2.0
LAST_SYNC: 2026-01-07
ORCHESTRATOR_MANAGED: true
-->
